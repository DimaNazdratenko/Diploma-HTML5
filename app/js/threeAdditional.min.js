var Bird=function(){var t=this;function e(e,r,o){t.vertices.push(new THREE.Vector3(e,r,o))}function r(e,r,o){t.faces.push(new THREE.Face3(e,r,o))}THREE.Geometry.call(this),e(5,0,0),e(-5,-2,1),e(-5,0,0),e(-5,-2,-1),e(0,2,-6),e(0,2,6),e(2,0,0),e(-3,0,0),r(0,2,1),r(4,7,6),r(5,6,7),this.computeFaceNormals()};Bird.prototype=Object.create(THREE.Geometry.prototype),Bird.prototype.constructor=Bird;
THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){e=e||{};var t,i,r,o,n,a,s,l,c,p,d,f,h,m,E,v,x,y,u,g=this,S=new THREE.Projector,R=void 0!==e.canvas?e.canvas:document.createElement("canvas"),T=R.width,w=R.height,M=Math.floor(T/2),C=Math.floor(w/2),H=0,b=0,L=T,B=w,P=1,z=R.getContext("2d",{alpha:!0===e.alpha}),W=new THREE.Color(0),j=!0===e.alpha?0:1,V=1,D=0,F=null,N=null,k=null,A=null,O=null,G=[],I=new THREE.Color,U=new THREE.Color,q=new THREE.Color,J=new THREE.Color,K={},Q=new THREE.Box2,X=new THREE.Box2,Y=new THREE.Box2,Z=new THREE.Color,$=new THREE.Color,_=new THREE.Color,ee=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Vector3,re=new THREE.Matrix3;function oe(e,t,i){fe(i.opacity),he(i.blending);var r=t.scale.x*M,o=t.scale.y*C,n=Math.sqrt(r*r+o*o);if(Y.min.set(e.x-n,e.y-n),Y.max.set(e.x+n,e.y+n),i.isSpriteMaterial){var a=i.map;if(null!==a){var s=K[a.id];if(void 0!==s&&s.version===a.version||(s=ce(a),K[a.id]=s),void 0!==s.canvas){ye(s.canvas);var l=a.image,c=l.width*a.offset.x,p=l.height*a.offset.y,d=l.width*a.repeat.x,f=l.height*a.repeat.y,h=r/d,m=o/f;z.save(),z.translate(e.x,e.y),0!==i.rotation&&z.rotate(i.rotation),z.translate(-r/2,-o/2),z.scale(h,m),z.translate(-c,-p),z.fillRect(c,p,d,f),z.restore()}}else ye(i.color.getStyle()),z.save(),z.translate(e.x,e.y),0!==i.rotation&&z.rotate(i.rotation),z.scale(r,-o),z.fillRect(-.5,-.5,1,1),z.restore()}else i.isSpriteCanvasMaterial?(xe(i.color.getStyle()),ye(i.color.getStyle()),z.save(),z.translate(e.x,e.y),0!==i.rotation&&z.rotate(i.rotation),z.scale(r,o),i.program(z),z.restore()):i.isPointsMaterial&&(ye(i.color.getStyle()),z.save(),z.translate(e.x,e.y),0!==i.rotation&&z.rotate(i.rotation),z.scale(r*i.size,-o*i.size),z.fillRect(-.5,-.5,1,1),z.restore())}function ne(e,t,i,r){if(fe(r.opacity),he(r.blending),z.beginPath(),z.moveTo(e.positionScreen.x,e.positionScreen.y),z.lineTo(t.positionScreen.x,t.positionScreen.y),r.isLineBasicMaterial){if(me(r.linewidth),Ee(r.linecap),ve(r.linejoin),r.vertexColors!==THREE.VertexColors)xe(r.color.getStyle());else{var o=i.vertexColors[0].getStyle(),n=i.vertexColors[1].getStyle();if(o===n)xe(o);else{try{var a=z.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,o),a.addColorStop(1,n)}catch(e){a=o}xe(a)}}r.isLineDashedMaterial&&ue([r.dashSize,r.gapSize]),z.stroke(),Y.expandByScalar(2*r.linewidth),r.isLineDashedMaterial&&ue([])}}function ae(e,t,i,o,n,a,S,R){var T,w,M,C,H,b;if(g.info.render.vertices+=3,g.info.render.faces++,fe(R.opacity),he(R.blending),s=e.positionScreen.x,l=e.positionScreen.y,c=t.positionScreen.x,p=t.positionScreen.y,d=i.positionScreen.x,f=i.positionScreen.y,T=s,w=l,M=c,C=p,H=d,b=f,z.beginPath(),z.moveTo(T,w),z.lineTo(M,C),z.lineTo(H,b),z.closePath(),(R.isMeshLambertMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial)&&null===R.map)U.copy(R.color),q.copy(R.emissive),R.vertexColors===THREE.FaceColors&&U.multiply(S.color),I.copy(Z),te.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),function(e,t,i){for(var o=0,n=r.length;o<n;o++){var a=r[o];if(J.copy(a.color),a.isDirectionalLight){var s=ee.setFromMatrixPosition(a.matrixWorld).normalize();if((l=t.dot(s))<=0)continue;l*=a.intensity,i.add(J.multiplyScalar(l))}else if(a.isPointLight){var l;if(s=ee.setFromMatrixPosition(a.matrixWorld),(l=t.dot(ee.subVectors(s,e).normalize()))<=0)continue;if(0==(l*=0==a.distance?1:1-Math.min(e.distanceTo(s)/a.distance,1)))continue;l*=a.intensity,i.add(J.multiplyScalar(l))}}}(te,S.normalModel,I),I.multiply(U).add(q),!0===R.wireframe?se(I,R.wireframeLinewidth,R.wireframeLinecap,R.wireframeLinejoin):le(I);else if(R.isMeshBasicMaterial||R.isMeshLambertMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial){if(null!==R.map)R.map.mapping===THREE.UVMapping&&(h=S.uvs,pe(s,l,c,p,d,f,h[o].x,h[o].y,h[n].x,h[n].y,h[a].x,h[a].y,R.map));else null!==R.envMap?R.envMap.mapping===THREE.SphericalReflectionMapping&&(ie.copy(S.vertexNormalsModel[o]).applyMatrix3(re),m=.5*ie.x+.5,E=.5*ie.y+.5,ie.copy(S.vertexNormalsModel[n]).applyMatrix3(re),v=.5*ie.x+.5,x=.5*ie.y+.5,ie.copy(S.vertexNormalsModel[a]).applyMatrix3(re),y=.5*ie.x+.5,u=.5*ie.y+.5,pe(s,l,c,p,d,f,m,E,v,x,y,u,R.envMap)):(I.copy(R.color),R.vertexColors===THREE.FaceColors&&I.multiply(S.color),!0===R.wireframe?se(I,R.wireframeLinewidth,R.wireframeLinecap,R.wireframeLinejoin):le(I))}else R.isMeshNormalMaterial?(ie.copy(S.normalModel).applyMatrix3(re),I.setRGB(ie.x,ie.y,ie.z).multiplyScalar(.5).addScalar(.5),!0===R.wireframe?se(I,R.wireframeLinewidth,R.wireframeLinecap,R.wireframeLinejoin):le(I)):(I.setRGB(1,1,1),!0===R.wireframe?se(I,R.wireframeLinewidth,R.wireframeLinecap,R.wireframeLinejoin):le(I))}function se(e,t,i,r){me(t),Ee(i),ve(r),xe(e.getStyle()),z.stroke(),Y.expandByScalar(2*t)}function le(e){ye(e.getStyle()),z.fill()}function ce(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var i=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,r=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,o=e.wrapS===THREE.MirroredRepeatWrapping,n=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(o?2:1),a.height=t.height*(n?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0===o&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0===n&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0===o&&!0===n&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var l="no-repeat";!0===i&&!0===r?l="repeat":!0===i?l="repeat-x":!0===r&&(l="repeat-y");var c=z.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function pe(e,t,i,r,o,n,a,s,l,c,p,d,f){var h=K[f.id];if(void 0!==h&&h.version===f.version||(h=ce(f),K[f.id]=h),void 0===h.canvas)return ye("rgba( 0, 0, 0, 1)"),void z.fill();ye(h.canvas);var m,E,v,x,y,u,g,S,R=f.offset.x/f.repeat.x,T=f.offset.y/f.repeat.y,w=f.image.width*f.repeat.x,M=f.image.height*f.repeat.y;l=(l+R)*w,c=(c+T)*M,p=(p+R)*w,d=(d+T)*M,i-=e,r-=t,o-=e,n-=t,0!==(g=(l-=a=(a+R)*w)*(d-=s=(s+T)*M)-(p-=a)*(c-=s))&&(y=e-(m=(d*i-c*o)*(S=1/g))*a-(v=(l*o-p*i)*S)*s,u=t-(E=(d*r-c*n)*S)*a-(x=(l*n-p*r)*S)*s,z.save(),z.transform(m,E,v,x,y,u),z.fill(),z.restore())}function de(e,t,i){var r,o=t.x-e.x,n=t.y-e.y,a=o*o+n*n;0!==a&&(o*=r=i/Math.sqrt(a),n*=r,t.x+=o,t.y+=n,e.x-=o,e.y-=n)}function fe(e){V!==e&&(z.globalAlpha=e,V=e)}function he(e){D!==e&&(e===THREE.NormalBlending?z.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?z.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?z.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(z.globalCompositeOperation="multiply"),D=e)}function me(e){k!==e&&(z.lineWidth=e,k=e)}function Ee(e){A!==e&&(z.lineCap=e,A=e)}function ve(e){O!==e&&(z.lineJoin=e,O=e)}function xe(e){F!==e&&(z.strokeStyle=e,F=e)}function ye(e){N!==e&&(z.fillStyle=e,N=e)}function ue(e){G.length!==e.length&&(z.setLineDash(e),G=e)}void 0===z.setLineDash&&(z.setLineDash=function(){}),this.domElement=R,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return z},this.getContextAttributes=function(){return z.getContextAttributes()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){void 0!==e&&(P=e)},this.setSize=function(e,t,i){T=e*P,w=t*P,R.width=T,R.height=w,M=Math.floor(T/2),C=Math.floor(w/2),!1!==i&&(R.style.width=e+"px",R.style.height=t+"px"),Q.min.set(-M,-C),Q.max.set(M,C),X.min.set(-M,-C),X.max.set(M,C),V=1,D=0,F=null,N=null,k=null,A=null,O=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){H=e*P,b=t*P,L=i*P,B=r*P},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){W.set(e),j=void 0!==t?t:1,X.min.set(-M,-C),X.max.set(M,C)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return W},this.getClearAlpha=function(){return j},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===X.isEmpty()&&(X.intersect(Q),X.expandByScalar(2),X.min.x=X.min.x+M,X.min.y=-X.min.y+C,X.max.x=X.max.x+M,X.max.y=-X.max.y+C,j<1&&z.clearRect(0|X.min.x,0|X.max.y,X.max.x-X.min.x|0,X.min.y-X.max.y|0),j>0&&(fe(1),he(THREE.NormalBlending),ye("rgba("+Math.floor(255*W.r)+","+Math.floor(255*W.g)+","+Math.floor(255*W.b)+","+j+")"),z.fillRect(0|X.min.x,0|X.max.y,X.max.x-X.min.x|0,X.min.y-X.max.y|0)),X.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,s){if(void 0!==s.isCamera){var l=e.background;l&&l.isColor?(fe(1),he(THREE.NormalBlending),ye(l.getStyle()),z.fillRect(0,0,T,w)):!0===this.autoClear&&this.clear(),g.info.render.vertices=0,g.info.render.faces=0,z.setTransform(L/T,0,0,-B/w,H,w-b),z.translate(M,C),t=S.projectScene(e,s,this.sortObjects,this.sortElements),i=t.elements,r=t.lights,re.getNormalMatrix(s.matrixWorldInverse),function(){Z.setRGB(0,0,0),$.setRGB(0,0,0),_.setRGB(0,0,0);for(var e=0,t=r.length;e<t;e++){var i=r[e],o=i.color;i.isAmbientLight?Z.add(o):i.isDirectionalLight?$.add(o):i.isPointLight&&_.add(o)}}();for(var c=0,p=i.length;c<p;c++){var d=i[c],f=d.material;if(void 0!==f&&0!==f.opacity){if(Y.makeEmpty(),d instanceof THREE.RenderableSprite)(o=d).x*=M,o.y*=C,oe(o,d,f);else if(d instanceof THREE.RenderableLine)o=d.v1,n=d.v2,o.positionScreen.x*=M,o.positionScreen.y*=C,n.positionScreen.x*=M,n.positionScreen.y*=C,Y.setFromPoints([o.positionScreen,n.positionScreen]),!0===Q.intersectsBox(Y)&&ne(o,n,d,f);else if(d instanceof THREE.RenderableFace){if(o=d.v1,n=d.v2,a=d.v3,o.positionScreen.z<-1||o.positionScreen.z>1)continue;if(n.positionScreen.z<-1||n.positionScreen.z>1)continue;if(a.positionScreen.z<-1||a.positionScreen.z>1)continue;o.positionScreen.x*=M,o.positionScreen.y*=C,n.positionScreen.x*=M,n.positionScreen.y*=C,a.positionScreen.x*=M,a.positionScreen.y*=C,f.overdraw>0&&(de(o.positionScreen,n.positionScreen,f.overdraw),de(n.positionScreen,a.positionScreen,f.overdraw),de(a.positionScreen,o.positionScreen,f.overdraw)),Y.setFromPoints([o.positionScreen,n.positionScreen,a.positionScreen]),!0===Q.intersectsBox(Y)&&ae(o,n,a,0,1,2,d,f)}X.union(Y)}}z.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}};
THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var e,r,t,i,n,o,a,s,l,c,p,E=[],u=0,f=[],h=0,d=[],m=0,v=[],y=0,x=[],R=0,T={objects:[],lights:[],elements:[]},H=new THREE.Vector3,g=new THREE.Vector4,w=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),S=new THREE.Box3,M=new Array(3),b=new THREE.Matrix4,z=new THREE.Matrix4,V=new THREE.Matrix4,j=new THREE.Matrix3,O=new THREE.Frustum,C=new THREE.Vector4,L=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var k=new function(){var e=[],r=[],i=[],o=null,s=null,l=new THREE.Matrix3;function c(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(p),i.copy(t).applyMatrix4(z);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=i.x>=-1&&i.x<=1&&i.y>=-1&&i.y<=1&&i.z>=-1&&i.z<=1}function E(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(M[0]=e.positionScreen,M[1]=r.positionScreen,M[2]=t.positionScreen,w.intersectsBox(S.setFromPoints(M)))}function u(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(t){s=(o=t).material,l.getNormalMatrix(o.matrixWorld),e.length=0,r.length=0,i.length=0},projectVertex:c,checkTriangleVisibility:E,checkBackfaceCulling:u,pushVertex:function(e,r,i){(t=W()).position.set(e,r,i),c(t)},pushNormal:function(r,t,i){e.push(r,t,i)},pushColor:function(e,t,i){r.push(e,t,i)},pushUv:function(e,r){i.push(e,r)},pushLine:function(e,t){var i=f[e],n=f[t];i.positionScreen.copy(i.position).applyMatrix4(V),n.positionScreen.copy(n.position).applyMatrix4(V),!0===G(i.positionScreen,n.positionScreen)&&(i.positionScreen.multiplyScalar(1/i.positionScreen.w),n.positionScreen.multiplyScalar(1/n.positionScreen.w),(a=F()).id=o.id,a.v1.copy(i),a.v2.copy(n),a.z=Math.max(i.positionScreen.z,n.positionScreen.z),a.renderOrder=o.renderOrder,a.material=o.material,o.material.vertexColors===THREE.VertexColors&&(a.vertexColors[0].fromArray(r,3*e),a.vertexColors[1].fromArray(r,3*t)),T.elements.push(a))},pushTriangle:function(r,t,a){var c=f[r],p=f[t],h=f[a];if(!1!==E(c,p,h)&&(s.side===THREE.DoubleSide||!0===u(c,p,h))){(n=A()).id=o.id,n.v1.copy(c),n.v2.copy(p),n.v3.copy(h),n.z=(c.positionScreen.z+p.positionScreen.z+h.positionScreen.z)/3,n.renderOrder=o.renderOrder,n.normalModel.fromArray(e,3*r),n.normalModel.applyMatrix3(l).normalize();for(var d=0;d<3;d++){var m=n.vertexNormalsModel[d];m.fromArray(e,3*arguments[d]),m.applyMatrix3(l).normalize(),n.uvs[d].fromArray(i,2*arguments[d])}n.vertexNormalsLength=3,n.material=o.material,T.elements.push(n)}}}};function B(t){(e=function(){if(r===u){var e=new THREE.RenderableObject;return E.push(e),u++,r++,e}return E[r++]}()).id=t.id,e.object=t,H.setFromMatrixPosition(t.matrixWorld),H.applyMatrix4(z),e.z=H.z,e.renderOrder=t.renderOrder,T.objects.push(e)}function N(e,r,t){var i=1/e.w;e.z*=i,e.z>=-1&&e.z<=1&&((l=function(){if(c===R){var e=new THREE.RenderableSprite;return x.push(e),R++,c++,e}return x[c++]}()).id=r.id,l.x=e.x*i,l.y=e.y*i,l.z=e.z,l.renderOrder=r.renderOrder,l.object=r,l.rotation=r.rotation,l.scale.x=r.scale.x*Math.abs(l.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),l.scale.y=r.scale.y*Math.abs(l.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),l.material=r.material,T.elements.push(l))}function W(){if(i===h){var e=new THREE.RenderableVertex;return f.push(e),h++,i++,e}return f[i++]}function A(){if(o===m){var e=new THREE.RenderableFace;return d.push(e),m++,o++,e}return d[o++]}function F(){if(s===y){var e=new THREE.RenderableLine;return v.push(e),y++,s++,e}return v[s++]}function P(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}function G(e,r){var t=0,i=1,n=e.z+e.w,o=r.z+r.w,a=-e.z+e.w,s=-r.z+r.w;return n>=0&&o>=0&&a>=0&&s>=0||!(n<0&&o<0||a<0&&s<0)&&(n<0?t=Math.max(t,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?t=Math.max(t,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<t)&&(e.lerp(r,t),r.lerp(e,1-i),!0))}this.projectScene=function(e,t,l,E){o=0,s=0,c=0,T.elements.length=0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),b.copy(t.matrixWorldInverse),z.multiplyMatrices(t.projectionMatrix,b),O.setFromMatrix(z),r=0,T.objects.length=0,T.lights.length=0,function e(r){if(!1!==r.visible){if(r instanceof THREE.Light)T.lights.push(r);else if(r instanceof THREE.Mesh||r instanceof THREE.Line||r instanceof THREE.Points){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===O.intersectsObject(r))return;B(r)}else if(r instanceof THREE.Sprite){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===O.intersectsSprite(r))return;B(r)}for(var t=r.children,i=0,n=t.length;i<n;i++)e(t[i])}}(e),!0===l&&T.objects.sort(P);for(var u=T.objects,h=0,d=u.length;h<d;h++){var m=u[h].object,v=m.geometry;if(k.setObject(m),p=m.matrixWorld,i=0,m instanceof THREE.Mesh){if(v instanceof THREE.BufferGeometry){var y=v.attributes,x=v.groups;if(void 0===y.position)continue;for(var R=0,w=(Te=y.position.array).length;R<w;R+=3)k.pushVertex(Te[R],Te[R+1],Te[R+2]);if(void 0!==y.normal){var S=y.normal.array;for(R=0,w=S.length;R<w;R+=3)k.pushNormal(S[R],S[R+1],S[R+2])}if(void 0!==y.uv){var M=y.uv.array;for(R=0,w=M.length;R<w;R+=2)k.pushUv(M[R],M[R+1])}if(null!==v.index){var D=v.index.array;if(x.length>0)for(var U=0;U<x.length;U++){var I=x[U];for(R=I.start,w=I.start+I.count;R<w;R+=3)k.pushTriangle(D[R],D[R+1],D[R+2])}else for(R=0,w=D.length;R<w;R+=3)k.pushTriangle(D[R],D[R+1],D[R+2])}else for(R=0,w=Te.length/3;R<w;R+=3)k.pushTriangle(R,R+1,R+2)}else if(v instanceof THREE.Geometry){var q=v.vertices,J=v.faces,K=v.faceVertexUvs[0];j.getNormalMatrix(p);for(var Q=m.material,X=Array.isArray(Q),Y=0,Z=q.length;Y<Z;Y++){var $=q[Y];if(H.copy($),!0===Q.morphTargets)for(var _=v.morphTargets,ee=m.morphTargetInfluences,re=0,te=_.length;re<te;re++){var ie=ee[re];if(0!==ie){var ne=_[re].vertices[Y];H.x+=(ne.x-$.x)*ie,H.y+=(ne.y-$.y)*ie,H.z+=(ne.z-$.z)*ie}}k.pushVertex(H.x,H.y,H.z)}for(var oe=0,ae=J.length;oe<ae;oe++){var se=J[oe];if(void 0!==(Q=!0===X?m.material[se.materialIndex]:m.material)){var le=Q.side,ce=f[se.a],pe=f[se.b],Ee=f[se.c];if(!1!==k.checkTriangleVisibility(ce,pe,Ee)){var ue=k.checkBackfaceCulling(ce,pe,Ee);if(le!==THREE.DoubleSide){if(le===THREE.FrontSide&&!1===ue)continue;if(le===THREE.BackSide&&!0===ue)continue}(n=A()).id=m.id,n.v1.copy(ce),n.v2.copy(pe),n.v3.copy(Ee),n.normalModel.copy(se.normal),!1!==ue||le!==THREE.BackSide&&le!==THREE.DoubleSide||n.normalModel.negate(),n.normalModel.applyMatrix3(j).normalize();for(var fe=se.vertexNormals,he=0,de=Math.min(fe.length,3);he<de;he++){var me=n.vertexNormalsModel[he];me.copy(fe[he]),!1!==ue||le!==THREE.BackSide&&le!==THREE.DoubleSide||me.negate(),me.applyMatrix3(j).normalize()}n.vertexNormalsLength=fe.length;var ve=K[oe];if(void 0!==ve)for(var ye=0;ye<3;ye++)n.uvs[ye].copy(ve[ye]);n.color=se.color,n.material=Q,n.z=(ce.positionScreen.z+pe.positionScreen.z+Ee.positionScreen.z)/3,n.renderOrder=m.renderOrder,T.elements.push(n)}}}}}else if(m instanceof THREE.Line){if(V.multiplyMatrices(z,p),v instanceof THREE.BufferGeometry){if(void 0!==(y=v.attributes).position){for(R=0,w=(Te=y.position.array).length;R<w;R+=3)k.pushVertex(Te[R],Te[R+1],Te[R+2]);if(void 0!==y.color){var xe=y.color.array;for(R=0,w=xe.length;R<w;R+=3)k.pushColor(xe[R],xe[R+1],xe[R+2])}if(null!==v.index)for(R=0,w=(D=v.index.array).length;R<w;R+=2)k.pushLine(D[R],D[R+1]);else{var Re=m instanceof THREE.LineSegments?2:1;for(R=0,w=Te.length/3-1;R<w;R+=Re)k.pushLine(R,R+1)}}}else if(v instanceof THREE.Geometry){if(0===(q=m.geometry.vertices).length)continue;(ce=W()).positionScreen.copy(q[0]).applyMatrix4(V);for(Re=m instanceof THREE.LineSegments?2:1,Y=1,Z=q.length;Y<Z;Y++)(ce=W()).positionScreen.copy(q[Y]).applyMatrix4(V),(Y+1)%Re>0||(pe=f[i-2],C.copy(ce.positionScreen),L.copy(pe.positionScreen),!0===G(C,L)&&(C.multiplyScalar(1/C.w),L.multiplyScalar(1/L.w),(a=F()).id=m.id,a.v1.positionScreen.copy(C),a.v2.positionScreen.copy(L),a.z=Math.max(C.z,L.z),a.renderOrder=m.renderOrder,a.material=m.material,m.material.vertexColors===THREE.VertexColors&&(a.vertexColors[0].copy(m.geometry.colors[Y]),a.vertexColors[1].copy(m.geometry.colors[Y-1])),T.elements.push(a)))}}else if(m instanceof THREE.Points){if(V.multiplyMatrices(z,p),v instanceof THREE.Geometry)for(Y=0,Z=(q=m.geometry.vertices).length;Y<Z;Y++){$=q[Y];g.set($.x,$.y,$.z,1),g.applyMatrix4(V),N(g,m,t)}else if(v instanceof THREE.BufferGeometry){if(void 0!==(y=v.attributes).position){var Te;for(R=0,w=(Te=y.position.array).length;R<w;R+=3)g.set(Te[R],Te[R+1],Te[R+2],1),g.applyMatrix4(V),N(g,m,t)}}}else m instanceof THREE.Sprite&&(g.set(p.elements[12],p.elements[13],p.elements[14],1),g.applyMatrix4(z),N(g,m,t))}return!0===E&&T.elements.sort(P),T}};