var Bird=function(){var o=this;function t(t,e,r){o.vertices.push(new THREE.Vector3(t,e,r))}function e(t,e,r){o.faces.push(new THREE.Face3(t,e,r))}THREE.Geometry.call(this),t(5,0,0),t(-5,-2,1),t(-5,0,0),t(-5,-2,-1),t(0,2,-6),t(0,2,6),t(2,0,0),t(-3,0,0),e(0,2,1),e(4,7,6),e(5,6,7),this.computeFaceNormals()};Bird.prototype=Object.create(THREE.Geometry.prototype),Bird.prototype.constructor=Bird;
THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.type="SpriteCanvasMaterial",this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial,THREE.SpriteCanvasMaterial.prototype.isSpriteCanvasMaterial=!0,THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return e.copy(this),e.color.copy(this.color),e.program=this.program,e},THREE.CanvasRenderer=function(e){e=e||{};var s,l,m,c,p,d,E,v,x,y,u,g,S,R,T,M,w,C,H,b=this,h=new THREE.Projector,r=void 0!==e.canvas?e.canvas:document.createElement("canvas"),f=r.width,L=r.height,B=Math.floor(f/2),P=Math.floor(L/2),z=0,W=0,V=f,j=L,o=1,D=r.getContext("2d",{alpha:!0===e.alpha}),i=new THREE.Color(0),n=!0===e.alpha?0:1,a=1,F=0,N=null,k=null,A=null,O=null,G=null,t=[],I=new THREE.Color,U=new THREE.Color,q=new THREE.Color,J=new THREE.Color,K={},Q=new THREE.Box2,X=new THREE.Box2,Y=new THREE.Box2,Z=new THREE.Color,$=new THREE.Color,_=new THREE.Color,ee=new THREE.Vector3,te=new THREE.Vector3,ie=new THREE.Vector3,re=new THREE.Matrix3;function oe(e,t,i){he(i.opacity),fe(i.blending);var r=t.scale.x*B,o=t.scale.y*P,n=Math.sqrt(r*r+o*o);if(Y.min.set(e.x-n,e.y-n),Y.max.set(e.x+n,e.y+n),i.isSpriteMaterial){var a=i.map;if(null!==a){var s=K[a.id];if(void 0!==s&&s.version===a.version||(s=ce(a),K[a.id]=s),void 0!==s.canvas){ye(s.canvas);var l=a.image,c=l.width*a.offset.x,p=l.height*a.offset.y,d=l.width*a.repeat.x,h=l.height*a.repeat.y,f=r/d,m=o/h;D.save(),D.translate(e.x,e.y),0!==i.rotation&&D.rotate(i.rotation),D.translate(-r/2,-o/2),D.scale(f,m),D.translate(-c,-p),D.fillRect(c,p,d,h),D.restore()}}else ye(i.color.getStyle()),D.save(),D.translate(e.x,e.y),0!==i.rotation&&D.rotate(i.rotation),D.scale(r,-o),D.fillRect(-.5,-.5,1,1),D.restore()}else i.isSpriteCanvasMaterial?(xe(i.color.getStyle()),ye(i.color.getStyle()),D.save(),D.translate(e.x,e.y),0!==i.rotation&&D.rotate(i.rotation),D.scale(r,o),i.program(D),D.restore()):i.isPointsMaterial&&(ye(i.color.getStyle()),D.save(),D.translate(e.x,e.y),0!==i.rotation&&D.rotate(i.rotation),D.scale(r*i.size,-o*i.size),D.fillRect(-.5,-.5,1,1),D.restore())}function ne(e,t,i,r){if(he(r.opacity),fe(r.blending),D.beginPath(),D.moveTo(e.positionScreen.x,e.positionScreen.y),D.lineTo(t.positionScreen.x,t.positionScreen.y),r.isLineBasicMaterial){if(me(r.linewidth),Ee(r.linecap),ve(r.linejoin),r.vertexColors!==THREE.VertexColors)xe(r.color.getStyle());else{var o=i.vertexColors[0].getStyle(),n=i.vertexColors[1].getStyle();if(o===n)xe(o);else{try{var a=D.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);a.addColorStop(0,o),a.addColorStop(1,n)}catch(e){a=o}xe(a)}}r.isLineDashedMaterial&&ue([r.dashSize,r.gapSize]),D.stroke(),Y.expandByScalar(2*r.linewidth),r.isLineDashedMaterial&&ue([])}}function ae(e,t,i,r,o,n,a,s){var l,c,p,d,h,f;if(b.info.render.vertices+=3,b.info.render.faces++,he(s.opacity),fe(s.blending),E=e.positionScreen.x,v=e.positionScreen.y,x=t.positionScreen.x,y=t.positionScreen.y,u=i.positionScreen.x,g=i.positionScreen.y,l=E,c=v,p=x,d=y,h=u,f=g,D.beginPath(),D.moveTo(l,c),D.lineTo(p,d),D.lineTo(h,f),D.closePath(),(s.isMeshLambertMaterial||s.isMeshPhongMaterial||s.isMeshStandardMaterial)&&null===s.map)U.copy(s.color),q.copy(s.emissive),s.vertexColors===THREE.FaceColors&&U.multiply(a.color),I.copy(Z),te.copy(e.positionWorld).add(t.positionWorld).add(i.positionWorld).divideScalar(3),function(e,t,i){for(var r=0,o=m.length;r<o;r++){var n=m[r];if(J.copy(n.color),n.isDirectionalLight){var a=ee.setFromMatrixPosition(n.matrixWorld).normalize();if((s=t.dot(a))<=0)continue;s*=n.intensity,i.add(J.multiplyScalar(s))}else if(n.isPointLight){var s;if(a=ee.setFromMatrixPosition(n.matrixWorld),(s=t.dot(ee.subVectors(a,e).normalize()))<=0)continue;if(0==(s*=0==n.distance?1:1-Math.min(e.distanceTo(a)/n.distance,1)))continue;s*=n.intensity,i.add(J.multiplyScalar(s))}}}(te,a.normalModel,I),I.multiply(U).add(q),!0===s.wireframe?se(I,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):le(I);else if(s.isMeshBasicMaterial||s.isMeshLambertMaterial||s.isMeshPhongMaterial||s.isMeshStandardMaterial){if(null!==s.map)s.map.mapping===THREE.UVMapping&&(S=a.uvs,pe(E,v,x,y,u,g,S[r].x,S[r].y,S[o].x,S[o].y,S[n].x,S[n].y,s.map));else null!==s.envMap?s.envMap.mapping===THREE.SphericalReflectionMapping&&(ie.copy(a.vertexNormalsModel[r]).applyMatrix3(re),R=.5*ie.x+.5,T=.5*ie.y+.5,ie.copy(a.vertexNormalsModel[o]).applyMatrix3(re),M=.5*ie.x+.5,w=.5*ie.y+.5,ie.copy(a.vertexNormalsModel[n]).applyMatrix3(re),C=.5*ie.x+.5,H=.5*ie.y+.5,pe(E,v,x,y,u,g,R,T,M,w,C,H,s.envMap)):(I.copy(s.color),s.vertexColors===THREE.FaceColors&&I.multiply(a.color),!0===s.wireframe?se(I,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):le(I))}else s.isMeshNormalMaterial?(ie.copy(a.normalModel).applyMatrix3(re),I.setRGB(ie.x,ie.y,ie.z).multiplyScalar(.5).addScalar(.5)):I.setRGB(1,1,1),!0===s.wireframe?se(I,s.wireframeLinewidth,s.wireframeLinecap,s.wireframeLinejoin):le(I)}function se(e,t,i,r){me(t),Ee(i),ve(r),xe(e.getStyle()),D.stroke(),Y.expandByScalar(2*t)}function le(e){ye(e.getStyle()),D.fill()}function ce(e){if(0===e.version||e instanceof THREE.CompressedTexture||e instanceof THREE.DataTexture)return{canvas:void 0,version:e.version};var t=e.image;if(!1===t.complete)return{canvas:void 0,version:0};var i=e.wrapS===THREE.RepeatWrapping||e.wrapS===THREE.MirroredRepeatWrapping,r=e.wrapT===THREE.RepeatWrapping||e.wrapT===THREE.MirroredRepeatWrapping,o=e.wrapS===THREE.MirroredRepeatWrapping,n=e.wrapT===THREE.MirroredRepeatWrapping,a=document.createElement("canvas");a.width=t.width*(o?2:1),a.height=t.height*(n?2:1);var s=a.getContext("2d");s.setTransform(1,0,0,-1,0,t.height),s.drawImage(t,0,0),!0===o&&(s.setTransform(-1,0,0,-1,t.width,t.height),s.drawImage(t,-t.width,0)),!0===n&&(s.setTransform(1,0,0,1,0,0),s.drawImage(t,0,t.height)),!0===o&&!0===n&&(s.setTransform(-1,0,0,1,t.width,0),s.drawImage(t,-t.width,t.height));var l="no-repeat";!0===i&&!0===r?l="repeat":!0===i?l="repeat-x":!0===r&&(l="repeat-y");var c=D.createPattern(a,l);return e.onUpdate&&e.onUpdate(e),{canvas:c,version:e.version}}function pe(e,t,i,r,o,n,a,s,l,c,p,d,h){var f=K[h.id];if(void 0!==f&&f.version===h.version||(f=ce(h),K[h.id]=f),void 0===f.canvas)return ye("rgba( 0, 0, 0, 1)"),void D.fill();ye(f.canvas);var m,E,v,x,y,u,g,S,R=h.offset.x/h.repeat.x,T=h.offset.y/h.repeat.y,M=h.image.width*h.repeat.x,w=h.image.height*h.repeat.y;l=(l+R)*M,c=(c+T)*w,p=(p+R)*M,d=(d+T)*w,i-=e,r-=t,o-=e,n-=t,0!==(g=(l-=a=(a+R)*M)*(d-=s=(s+T)*w)-(p-=a)*(c-=s))&&(y=e-(m=(d*i-c*o)*(S=1/g))*a-(v=(l*o-p*i)*S)*s,u=t-(E=(d*r-c*n)*S)*a-(x=(l*n-p*r)*S)*s,D.save(),D.transform(m,E,v,x,y,u),D.fill(),D.restore())}function de(e,t,i){var r,o=t.x-e.x,n=t.y-e.y,a=o*o+n*n;0!==a&&(o*=r=i/Math.sqrt(a),n*=r,t.x+=o,t.y+=n,e.x-=o,e.y-=n)}function he(e){a!==e&&(D.globalAlpha=e,a=e)}function fe(e){F!==e&&(e===THREE.NormalBlending?D.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?D.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending?D.globalCompositeOperation="darker":e===THREE.MultiplyBlending&&(D.globalCompositeOperation="multiply"),F=e)}function me(e){A!==e&&(D.lineWidth=e,A=e)}function Ee(e){O!==e&&(D.lineCap=e,O=e)}function ve(e){G!==e&&(D.lineJoin=e,G=e)}function xe(e){N!==e&&(D.strokeStyle=e,N=e)}function ye(e){k!==e&&(D.fillStyle=e,k=e)}function ue(e){t.length!==e.length&&(D.setLineDash(e),t=e)}void 0===D.setLineDash&&(D.setLineDash=function(){}),this.domElement=r,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.getContext=function(){return D},this.getContextAttributes=function(){return D.getContextAttributes()},this.getPixelRatio=function(){return o},this.setPixelRatio=function(e){void 0!==e&&(o=e)},this.setSize=function(e,t,i){f=e*o,L=t*o,r.width=f,r.height=L,B=Math.floor(f/2),P=Math.floor(L/2),!1!==i&&(r.style.width=e+"px",r.style.height=t+"px"),Q.min.set(-B,-P),Q.max.set(B,P),X.min.set(-B,-P),X.max.set(B,P),a=1,F=0,G=O=A=k=N=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,i,r){z=e*o,W=t*o,V=i*o,j=r*o},this.setScissor=function(){},this.setScissorTest=function(){},this.setClearColor=function(e,t){i.set(e),n=void 0!==t?t:1,X.min.set(-B,-P),X.max.set(B,P)},this.setClearColorHex=function(e,t){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return i},this.getClearAlpha=function(){return n},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===X.isEmpty()&&(X.intersect(Q),X.expandByScalar(2),X.min.x=X.min.x+B,X.min.y=-X.min.y+P,X.max.x=X.max.x+B,X.max.y=-X.max.y+P,n<1&&D.clearRect(0|X.min.x,0|X.max.y,X.max.x-X.min.x|0,X.min.y-X.max.y|0),0<n&&(he(1),fe(THREE.NormalBlending),ye("rgba("+Math.floor(255*i.r)+","+Math.floor(255*i.g)+","+Math.floor(255*i.b)+","+n+")"),D.fillRect(0|X.min.x,0|X.max.y,X.max.x-X.min.x|0,X.min.y-X.max.y|0)),X.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,t){if(void 0!==t.isCamera){var i=e.background;i&&i.isColor?(he(1),fe(THREE.NormalBlending),ye(i.getStyle()),D.fillRect(0,0,f,L)):!0===this.autoClear&&this.clear(),b.info.render.vertices=0,b.info.render.faces=0,D.setTransform(V/f,0,0,-j/L,z,L-W),D.translate(B,P),s=h.projectScene(e,t,this.sortObjects,this.sortElements),l=s.elements,m=s.lights,re.getNormalMatrix(t.matrixWorldInverse),function(){Z.setRGB(0,0,0),$.setRGB(0,0,0),_.setRGB(0,0,0);for(var e=0,t=m.length;e<t;e++){var i=m[e],r=i.color;i.isAmbientLight?Z.add(r):i.isDirectionalLight?$.add(r):i.isPointLight&&_.add(r)}}();for(var r=0,o=l.length;r<o;r++){var n=l[r],a=n.material;if(void 0!==a&&0!==a.opacity){if(Y.makeEmpty(),n instanceof THREE.RenderableSprite)(c=n).x*=B,c.y*=P,oe(c,n,a);else if(n instanceof THREE.RenderableLine)c=n.v1,p=n.v2,c.positionScreen.x*=B,c.positionScreen.y*=P,p.positionScreen.x*=B,p.positionScreen.y*=P,Y.setFromPoints([c.positionScreen,p.positionScreen]),!0===Q.intersectsBox(Y)&&ne(c,p,n,a);else if(n instanceof THREE.RenderableFace){if(c=n.v1,p=n.v2,d=n.v3,c.positionScreen.z<-1||1<c.positionScreen.z)continue;if(p.positionScreen.z<-1||1<p.positionScreen.z)continue;if(d.positionScreen.z<-1||1<d.positionScreen.z)continue;c.positionScreen.x*=B,c.positionScreen.y*=P,p.positionScreen.x*=B,p.positionScreen.y*=P,d.positionScreen.x*=B,d.positionScreen.y*=P,0<a.overdraw&&(de(c.positionScreen,p.positionScreen,a.overdraw),de(p.positionScreen,d.positionScreen,a.overdraw),de(d.positionScreen,c.positionScreen,a.overdraw)),Y.setFromPoints([c.positionScreen,p.positionScreen,d.positionScreen]),!0===Q.intersectsBox(Y)&&ae(c,p,d,0,1,2,n,a)}X.union(Y)}}D.setTransform(1,0,0,1,0,0)}else console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.")}};
THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0,this.renderOrder=0},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.color=new THREE.Color,this.material=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0,this.renderOrder=0},THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0,this.renderOrder=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null,this.renderOrder=0},THREE.Projector=function(){var r,X,o,Y,Z,$,_,ee,n,re,te,t=[],i=0,ie=[],a=0,s=[],l=0,c=[],p=0,E=[],u=0,ne={objects:[],lights:[],elements:[]},oe=new THREE.Vector3,ae=new THREE.Vector4,d=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),m=new THREE.Box3,v=new Array(3),se=new THREE.Matrix4,le=new THREE.Matrix4,ce=new THREE.Matrix4,pe=new THREE.Matrix3,Ee=new THREE.Frustum,ue=new THREE.Vector4,fe=new THREE.Vector4;this.projectVector=function(e,r){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(r)},this.unprojectVector=function(e,r){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(r)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var he=new function(){var l=[],n=[],c=[],p=null,E=null,u=new THREE.Matrix3;function i(e){var r=e.position,t=e.positionWorld,i=e.positionScreen;t.copy(r).applyMatrix4(te),i.copy(t).applyMatrix4(le);var n=1/i.w;i.x*=n,i.y*=n,i.z*=n,e.visible=-1<=i.x&&i.x<=1&&-1<=i.y&&i.y<=1&&-1<=i.z&&i.z<=1}function f(e,r,t){return!0===e.visible||!0===r.visible||!0===t.visible||(v[0]=e.positionScreen,v[1]=r.positionScreen,v[2]=t.positionScreen,d.intersectsBox(m.setFromPoints(v)))}function h(e,r,t){return(t.positionScreen.x-e.positionScreen.x)*(r.positionScreen.y-e.positionScreen.y)-(t.positionScreen.y-e.positionScreen.y)*(r.positionScreen.x-e.positionScreen.x)<0}return{setObject:function(e){E=(p=e).material,u.getNormalMatrix(p.matrixWorld),l.length=0,n.length=0,c.length=0},projectVertex:i,checkTriangleVisibility:f,checkBackfaceCulling:h,pushVertex:function(e,r,t){(o=ve()).position.set(e,r,t),i(o)},pushNormal:function(e,r,t){l.push(e,r,t)},pushColor:function(e,r,t){n.push(e,r,t)},pushUv:function(e,r){c.push(e,r)},pushLine:function(e,r){var t=ie[e],i=ie[r];t.positionScreen.copy(t.position).applyMatrix4(ce),i.positionScreen.copy(i.position).applyMatrix4(ce),!0===Te(t.positionScreen,i.positionScreen)&&(t.positionScreen.multiplyScalar(1/t.positionScreen.w),i.positionScreen.multiplyScalar(1/i.positionScreen.w),(_=xe()).id=p.id,_.v1.copy(t),_.v2.copy(i),_.z=Math.max(t.positionScreen.z,i.positionScreen.z),_.renderOrder=p.renderOrder,_.material=p.material,p.material.vertexColors===THREE.VertexColors&&(_.vertexColors[0].fromArray(n,3*e),_.vertexColors[1].fromArray(n,3*r)),ne.elements.push(_))},pushTriangle:function(e,r,t){var i=ie[e],n=ie[r],o=ie[t];if(!1!==f(i,n,o)&&(E.side===THREE.DoubleSide||!0===h(i,n,o))){(Z=ye()).id=p.id,Z.v1.copy(i),Z.v2.copy(n),Z.v3.copy(o),Z.z=(i.positionScreen.z+n.positionScreen.z+o.positionScreen.z)/3,Z.renderOrder=p.renderOrder,Z.normalModel.fromArray(l,3*e),Z.normalModel.applyMatrix3(u).normalize();for(var a=0;a<3;a++){var s=Z.vertexNormalsModel[a];s.fromArray(l,3*arguments[a]),s.applyMatrix3(u).normalize(),Z.uvs[a].fromArray(c,2*arguments[a])}Z.vertexNormalsLength=3,Z.material=p.material,ne.elements.push(Z)}}}};function de(e){(r=function(){if(X!==i)return t[X++];var e=new THREE.RenderableObject;return t.push(e),i++,X++,e}()).id=e.id,r.object=e,oe.setFromMatrixPosition(e.matrixWorld),oe.applyMatrix4(le),r.z=oe.z,r.renderOrder=e.renderOrder,ne.objects.push(r)}function me(e,r,t){var i=1/e.w;e.z*=i,-1<=e.z&&e.z<=1&&((n=function(){if(re!==u)return E[re++];var e=new THREE.RenderableSprite;return E.push(e),u++,re++,e}()).id=r.id,n.x=e.x*i,n.y=e.y*i,n.z=e.z,n.renderOrder=r.renderOrder,n.object=r,n.rotation=r.rotation,n.scale.x=r.scale.x*Math.abs(n.x-(e.x+t.projectionMatrix.elements[0])/(e.w+t.projectionMatrix.elements[12])),n.scale.y=r.scale.y*Math.abs(n.y-(e.y+t.projectionMatrix.elements[5])/(e.w+t.projectionMatrix.elements[13])),n.material=r.material,ne.elements.push(n))}function ve(){if(Y!==a)return ie[Y++];var e=new THREE.RenderableVertex;return ie.push(e),a++,Y++,e}function ye(){if($!==l)return s[$++];var e=new THREE.RenderableFace;return s.push(e),l++,$++,e}function xe(){if(ee!==p)return c[ee++];var e=new THREE.RenderableLine;return c.push(e),p++,ee++,e}function Re(e,r){return e.renderOrder!==r.renderOrder?e.renderOrder-r.renderOrder:e.z!==r.z?r.z-e.z:e.id!==r.id?e.id-r.id:0}function Te(e,r){var t=0,i=1,n=e.z+e.w,o=r.z+r.w,a=-e.z+e.w,s=-r.z+r.w;return 0<=n&&0<=o&&0<=a&&0<=s||!(n<0&&o<0||a<0&&s<0)&&(n<0?t=Math.max(t,n/(n-o)):o<0&&(i=Math.min(i,n/(n-o))),a<0?t=Math.max(t,a/(a-s)):s<0&&(i=Math.min(i,a/(a-s))),!(i<t)&&(e.lerp(r,t),r.lerp(e,1-i),!0))}this.projectScene=function(e,r,t,i){re=ee=$=0,!(ne.elements.length=0)===e.autoUpdate&&e.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),se.copy(r.matrixWorldInverse),le.multiplyMatrices(r.projectionMatrix,se),Ee.setFromMatrix(le),X=0,ne.objects.length=0,ne.lights.length=0,function e(r){if(!1!==r.visible){if(r instanceof THREE.Light)ne.lights.push(r);else if(r instanceof THREE.Mesh||r instanceof THREE.Line||r instanceof THREE.Points){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===Ee.intersectsObject(r))return;de(r)}else if(r instanceof THREE.Sprite){if(!1===r.material.visible)return;if(!0===r.frustumCulled&&!1===Ee.intersectsSprite(r))return;de(r)}for(var t=r.children,i=0,n=t.length;i<n;i++)e(t[i])}}(e),!0===t&&ne.objects.sort(Re);for(var n=ne.objects,o=0,a=n.length;o<a;o++){var s=n[o].object,l=s.geometry;if(he.setObject(s),te=s.matrixWorld,Y=0,s instanceof THREE.Mesh){if(l instanceof THREE.BufferGeometry){var c=l.attributes,p=l.groups;if(void 0===c.position)continue;for(var E=0,u=(Q=c.position.array).length;E<u;E+=3)he.pushVertex(Q[E],Q[E+1],Q[E+2]);if(void 0!==c.normal){var f=c.normal.array;for(E=0,u=f.length;E<u;E+=3)he.pushNormal(f[E],f[E+1],f[E+2])}if(void 0!==c.uv){var h=c.uv.array;for(E=0,u=h.length;E<u;E+=2)he.pushUv(h[E],h[E+1])}if(null!==l.index){var d=l.index.array;if(0<p.length)for(var m=0;m<p.length;m++){var v=p[m];for(E=v.start,u=v.start+v.count;E<u;E+=3)he.pushTriangle(d[E],d[E+1],d[E+2])}else for(E=0,u=d.length;E<u;E+=3)he.pushTriangle(d[E],d[E+1],d[E+2])}else for(E=0,u=Q.length/3;E<u;E+=3)he.pushTriangle(E,E+1,E+2)}else if(l instanceof THREE.Geometry){var y=l.vertices,x=l.faces,R=l.faceVertexUvs[0];pe.getNormalMatrix(te);for(var T=s.material,H=Array.isArray(T),g=0,w=y.length;g<w;g++){var S=y[g];if(oe.copy(S),!0===T.morphTargets)for(var M=l.morphTargets,b=s.morphTargetInfluences,z=0,V=M.length;z<V;z++){var j=b[z];if(0!==j){var O=M[z].vertices[g];oe.x+=(O.x-S.x)*j,oe.y+=(O.y-S.y)*j,oe.z+=(O.z-S.z)*j}}he.pushVertex(oe.x,oe.y,oe.z)}for(var C=0,L=x.length;C<L;C++){var k=x[C];if(void 0!==(T=!0===H?s.material[k.materialIndex]:s.material)){var B=T.side,N=ie[k.a],W=ie[k.b],A=ie[k.c];if(!1!==he.checkTriangleVisibility(N,W,A)){var F=he.checkBackfaceCulling(N,W,A);if(B!==THREE.DoubleSide){if(B===THREE.FrontSide&&!1===F)continue;if(B===THREE.BackSide&&!0===F)continue}(Z=ye()).id=s.id,Z.v1.copy(N),Z.v2.copy(W),Z.v3.copy(A),Z.normalModel.copy(k.normal),!1!==F||B!==THREE.BackSide&&B!==THREE.DoubleSide||Z.normalModel.negate(),Z.normalModel.applyMatrix3(pe).normalize();for(var P=k.vertexNormals,G=0,D=Math.min(P.length,3);G<D;G++){var U=Z.vertexNormalsModel[G];U.copy(P[G]),!1!==F||B!==THREE.BackSide&&B!==THREE.DoubleSide||U.negate(),U.applyMatrix3(pe).normalize()}Z.vertexNormalsLength=P.length;var I=R[C];if(void 0!==I)for(var q=0;q<3;q++)Z.uvs[q].copy(I[q]);Z.color=k.color,Z.material=T,Z.z=(N.positionScreen.z+W.positionScreen.z+A.positionScreen.z)/3,Z.renderOrder=s.renderOrder,ne.elements.push(Z)}}}}}else if(s instanceof THREE.Line){if(ce.multiplyMatrices(le,te),l instanceof THREE.BufferGeometry){if(void 0!==(c=l.attributes).position){for(E=0,u=(Q=c.position.array).length;E<u;E+=3)he.pushVertex(Q[E],Q[E+1],Q[E+2]);if(void 0!==c.color){var J=c.color.array;for(E=0,u=J.length;E<u;E+=3)he.pushColor(J[E],J[E+1],J[E+2])}if(null!==l.index)for(E=0,u=(d=l.index.array).length;E<u;E+=2)he.pushLine(d[E],d[E+1]);else{var K=s instanceof THREE.LineSegments?2:1;for(E=0,u=Q.length/3-1;E<u;E+=K)he.pushLine(E,E+1)}}}else if(l instanceof THREE.Geometry){if(0===(y=s.geometry.vertices).length)continue;(N=ve()).positionScreen.copy(y[0]).applyMatrix4(ce);for(K=s instanceof THREE.LineSegments?2:1,g=1,w=y.length;g<w;g++)(N=ve()).positionScreen.copy(y[g]).applyMatrix4(ce),0<(g+1)%K||(W=ie[Y-2],ue.copy(N.positionScreen),fe.copy(W.positionScreen),!0===Te(ue,fe)&&(ue.multiplyScalar(1/ue.w),fe.multiplyScalar(1/fe.w),(_=xe()).id=s.id,_.v1.positionScreen.copy(ue),_.v2.positionScreen.copy(fe),_.z=Math.max(ue.z,fe.z),_.renderOrder=s.renderOrder,_.material=s.material,s.material.vertexColors===THREE.VertexColors&&(_.vertexColors[0].copy(s.geometry.colors[g]),_.vertexColors[1].copy(s.geometry.colors[g-1])),ne.elements.push(_)))}}else if(s instanceof THREE.Points){if(ce.multiplyMatrices(le,te),l instanceof THREE.Geometry)for(g=0,w=(y=s.geometry.vertices).length;g<w;g++){S=y[g];ae.set(S.x,S.y,S.z,1),ae.applyMatrix4(ce),me(ae,s,r)}else if(l instanceof THREE.BufferGeometry){if(void 0!==(c=l.attributes).position){var Q;for(E=0,u=(Q=c.position.array).length;E<u;E+=3)ae.set(Q[E],Q[E+1],Q[E+2],1),ae.applyMatrix4(ce),me(ae,s,r)}}}else s instanceof THREE.Sprite&&(ae.set(te.elements[12],te.elements[13],te.elements[14],1),ae.applyMatrix4(le),me(ae,s,r))}return!0===i&&ne.elements.sort(Re),ne}};