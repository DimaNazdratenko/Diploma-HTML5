var Boid=function(){var i,t,o=new THREE.Vector3,s=500,n=500,a=200,e=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,i=new THREE.Vector3,this.setGoal=function(i){t=i},this.setAvoidWalls=function(i){e=i},this.setWorldSize=function(i,t,o){s=i,n=t,a=o},this.run=function(t){e&&(o.set(-s,this.position.y,this.position.z),(o=this.avoid(o)).multiplyScalar(5),i.add(o),o.set(s,this.position.y,this.position.z),(o=this.avoid(o)).multiplyScalar(5),i.add(o),o.set(this.position.x,-n,this.position.z),(o=this.avoid(o)).multiplyScalar(5),i.add(o),o.set(this.position.x,n,this.position.z),(o=this.avoid(o)).multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,-a),(o=this.avoid(o)).multiplyScalar(5),i.add(o),o.set(this.position.x,this.position.y,a),(o=this.avoid(o)).multiplyScalar(5),i.add(o)),Math.random()>.5&&this.flock(t),this.move()},this.flock=function(o){t&&i.add(this.reach(t,.005)),i.add(this.alignment(o)),i.add(this.cohesion(o)),i.add(this.separation(o))},this.move=function(){this.velocity.add(i);var t=this.velocity.length();t>4&&this.velocity.divideScalar(t/4),this.position.add(this.velocity),i.set(0,0,0)},this.checkBounds=function(){this.position.x>s&&(this.position.x=-s),this.position.x<-s&&(this.position.x=s),this.position.y>n&&(this.position.y=-n),this.position.y<-n&&(this.position.y=n),this.position.z>a&&(this.position.z=-a),this.position.z<-a&&(this.position.z=a)},this.avoid=function(i){var t=new THREE.Vector3;return t.copy(this.position),t.sub(i),t.multiplyScalar(1/this.position.distanceToSquared(i)),t},this.repulse=function(t){var o=this.position.distanceTo(t);if(o<150){var s=new THREE.Vector3;s.subVectors(this.position,t),s.multiplyScalar(.5/o),i.add(s)}},this.reach=function(i,t){var o=new THREE.Vector3;return o.subVectors(i,this.position),o.multiplyScalar(t),o},this.alignment=function(i){for(var t=0,o=new THREE.Vector3,s=0,n=i.length;s<n;s++)if(!(Math.random()>.6)){var a=i[s],e=a.position.distanceTo(this.position);e>0&&e<=100&&(o.add(a.velocity),t++)}if(t>0){o.divideScalar(t);var h=o.length();h>.1&&o.divideScalar(h/.1)}return o},this.cohesion=function(i){for(var t=0,o=new THREE.Vector3,s=new THREE.Vector3,n=0,a=i.length;n<a;n++)if(!(Math.random()>.6)){var e=i[n],h=e.position.distanceTo(this.position);h>0&&h<=100&&(o.add(e.position),t++)}t>0&&o.divideScalar(t),s.subVectors(o,this.position);var r=s.length();return r>.1&&s.divideScalar(r/.1),s},this.separation=function(i){for(var t=new THREE.Vector3,o=new THREE.Vector3,s=0,n=i.length;s<n;s++)if(!(Math.random()>.6)){var a=i[s],e=a.position.distanceTo(this.position);e>0&&e<=100&&(o.subVectors(this.position,a.position),o.normalize(),o.divideScalar(e),t.add(o))}return t}};