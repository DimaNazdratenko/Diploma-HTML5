var Boid=function(){var s,t,o=new THREE.Vector3,n=500,a=500,e=200,h=!1;this.position=new THREE.Vector3,this.velocity=new THREE.Vector3,s=new THREE.Vector3,this.setGoal=function(i){t=i},this.setAvoidWalls=function(i){h=i},this.setWorldSize=function(i,t,o){n=i,a=t,e=o},this.run=function(i){h&&(o.set(-n,this.position.y,this.position.z),(o=this.avoid(o)).multiplyScalar(5),s.add(o),o.set(n,this.position.y,this.position.z),(o=this.avoid(o)).multiplyScalar(5),s.add(o),o.set(this.position.x,-a,this.position.z),(o=this.avoid(o)).multiplyScalar(5),s.add(o),o.set(this.position.x,a,this.position.z),(o=this.avoid(o)).multiplyScalar(5),s.add(o),o.set(this.position.x,this.position.y,-e),(o=this.avoid(o)).multiplyScalar(5),s.add(o),o.set(this.position.x,this.position.y,e),(o=this.avoid(o)).multiplyScalar(5),s.add(o)),.5<Math.random()&&this.flock(i),this.move()},this.flock=function(i){t&&s.add(this.reach(t,.005)),s.add(this.alignment(i)),s.add(this.cohesion(i)),s.add(this.separation(i))},this.move=function(){this.velocity.add(s);var i=this.velocity.length();4<i&&this.velocity.divideScalar(i/4),this.position.add(this.velocity),s.set(0,0,0)},this.checkBounds=function(){this.position.x>n&&(this.position.x=-n),this.position.x<-n&&(this.position.x=n),this.position.y>a&&(this.position.y=-a),this.position.y<-a&&(this.position.y=a),this.position.z>e&&(this.position.z=-e),this.position.z<-e&&(this.position.z=e)},this.avoid=function(i){var t=new THREE.Vector3;return t.copy(this.position),t.sub(i),t.multiplyScalar(1/this.position.distanceToSquared(i)),t},this.repulse=function(i){var t=this.position.distanceTo(i);if(t<150){var o=new THREE.Vector3;o.subVectors(this.position,i),o.multiplyScalar(.5/t),s.add(o)}},this.reach=function(i,t){var o=new THREE.Vector3;return o.subVectors(i,this.position),o.multiplyScalar(t),o},this.alignment=function(i){for(var t=0,o=new THREE.Vector3,s=0,n=i.length;s<n;s++)if(!(.6<Math.random())){var a=i[s],e=a.position.distanceTo(this.position);0<e&&e<=100&&(o.add(a.velocity),t++)}if(0<t){o.divideScalar(t);var h=o.length();.1<h&&o.divideScalar(h/.1)}return o},this.cohesion=function(i){for(var t=0,o=new THREE.Vector3,s=new THREE.Vector3,n=0,a=i.length;n<a;n++)if(!(.6<Math.random())){var e=i[n],h=e.position.distanceTo(this.position);0<h&&h<=100&&(o.add(e.position),t++)}0<t&&o.divideScalar(t),s.subVectors(o,this.position);var r=s.length();return.1<r&&s.divideScalar(r/.1),s},this.separation=function(i){for(var t=new THREE.Vector3,o=new THREE.Vector3,s=0,n=i.length;s<n;s++)if(!(.6<Math.random())){var a=i[s],e=a.position.distanceTo(this.position);0<e&&e<=100&&(o.subVectors(this.position,a.position),o.normalize(),o.divideScalar(e),t.add(o))}return t}};