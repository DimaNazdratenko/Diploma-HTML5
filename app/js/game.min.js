function backgroundAddOnScene(){var e={textureLayer5:Texture.fromImage(imageLinks.background5),textureLayer4:Texture.fromImage(imageLinks.background4),textureLayer3:Texture.fromImage(imageLinks.background3),textureLayer2:Texture.fromImage(imageLinks.background2),textureLayer1:Texture.fromImage(imageLinks.background1)};for(var r in layer={layer5:new tilingSprite(e.textureLayer5,renderer.width,renderer.height),layer4:new tilingSprite(e.textureLayer4,renderer.width,renderer.height),layer3:new tilingSprite(e.textureLayer3,renderer.width,renderer.height),layer2:new tilingSprite(e.textureLayer2,renderer.width,renderer.height),layer1:new tilingSprite(e.textureLayer1,renderer.width,renderer.height)},layer)gameScene.addChild(layer[r])}function backgroundLogic(e,r,t){e.tilePosition.x=-t/1e3*r}
class Button extends PIXI.Sprite{constructor(e,t,...n){super(...n),this.textureButton=e,this.texture=this.textureButton.original,this.buttonMode=!0,this.interactive=!0,this.scale.set(this.textureButton.scale,this.textureButton.scale),this.x=this.textureButton.positionX-this.width/2,this.y=this.textureButton.positionY-this.height/2,this.isdown=!1,this.fullIphone=!1,this.buttonType=t,this.on("mousedown",this.onButtonDown).on("touchstart",this.onButtonDown).on("mouseup",this.onButtonUp).on("touchend",this.onButtonUp).on("mouseupoutside",this.onButtonUpOutside).on("touchendoutside",this.onButtonUpOutside).on("mouseover",this.onButtonOver).on("mouseout",this.onButtonOut)}onButtonDown(){this.isdown=!0,this.texture=this.textureButton.down,this.alpha=1}onButtonUp(e){this.isdown&&(this.isdown=!1,this.texture=this.textureButton.original,"start"===this.buttonType?(state=setup,musicBackground.play(),this.interactive=!1):"replay"===this.buttonType?(state=reset,musicGameOver.stop()):"fullscreen"===this.buttonType&&"mouseup"==e.type?Button.toggleFullScreen():"fullscreen"===this.buttonType&&"touchend"==e.type&&this.toggleFullScreenIphone())}onButtonUpOutside(){this.isdown=!1,this.texture=this.textureButton.original}onButtonOver(){this.isdown||(this.texture=this.textureButton.over)}onButtonOut(){this.isdown||(this.texture=this.textureButton.original)}toggleFullScreenIphone(){!this.fullIphone&&window.innerWidth/window.innerHeight>1?(this.fullIphone=!0,renderer.view.style.position="absolute",renderer.view.style.top="0",renderer.view.style.left="0",renderer.view.style.width="100%",renderer.view.style.height="100%",renderer.view.style.zIndex="1030",rotateScreen.visible=!1):!this.fullIphone&&window.innerWidth/window.innerHeight<1?(this.fullIphone=!1,rotateScreen.visible=!0):(this.fullIphone=!1,renderer.view.style.position="",renderer.view.style.zIndex="10",resizeCanvas())}static toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement?(fullscreenIndex=1.3,document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()):(fullscreenIndex=1,renderer.view.requestFullscreen?renderer.view.requestFullscreen():renderer.view.mozRequestFullScreen?renderer.view.mozRequestFullScreen():renderer.view.webkitRequestFullscreen&&renderer.view.webkitRequestFullscreen())}}
function detectCollision(i,e){var t=!1;return e.forEach(function(e,c){(function(e){var t,c,h,l,o;t=!1,i.centerX=i.x,i.centerY=i.y,e.movieclip.centerX=e.movieclip.x,e.movieclip.centerY=e.movieclip.y,i.halfWidth=i.width/2,i.halfHeight=i.height/2,e.movieclip.halfWidth=e.movieclip.width/2,e.movieclip.halfHeight=e.movieclip.height/2,l=i.centerX-e.movieclip.centerX,o=i.centerY-e.movieclip.centerY,c=i.halfHeight+e.movieclip.halfWidth,h=i.halfWidth+e.movieclip.halfHeight,t=Math.abs(l)<c&&Math.abs(o)<h;return t})(e)&&(t=!0,flagCollision=c)}),t}
function end(){if(gameOverScene.visible=!0,void 0!=flagCollision){plane.rotation-=.03,plane.y+=Position.STEP_Y;for(var e=0;e<enemy.length;e++)e!=flagCollision?enemy[e].movieclip.y+=Position.STEP_Y/2:(enemy[e].movieclip.rotation+=.03,enemy[e].movieclip.y+=Position.STEP_Y)}gameOverScene.addChild(score),gameScene.removeChild(score),(score.x<=renderer.width/2-score.width/2||score.y>=renderer.height/3-message.height)&&(score.x+=2.7,score.y-=3),score.scale.x<=1.2&&score.scale.y<=1.2&&(score.scale.x+=.002,score.scale.y+=.002),gameScene.filters=[blurFilter],filtersValue+=.005,blurFilter.blur=10*Math.sin(filtersValue)}
let Container=PIXI.Container,autoDetectRenderer=PIXI.autoDetectRenderer,loader=PIXI.loader,Texture=PIXI.Texture,Sprite=PIXI.Sprite,tilingSprite=PIXI.extras.TilingSprite,Text=PIXI.Text,Graphics=PIXI.Graphics,filters=PIXI.filters,AnimatedSprite=PIXI.extras.AnimatedSprite;const size=[960,540],ratio=size[0]/size[1],renderer=autoDetectRenderer(size[0],size[1]);let stage=new Container,gameElements=new Container,uiElements=new Container;stage.addChild(gameElements),stage.addChild(uiElements),document.querySelector("div.canvas").appendChild(renderer.view);let state,preLoaderScene,gameScene,gameOverScene,layer,score,message,rotateScreen,plane,distance,gameTime,startTime,darkEffectEndGame,darkEffectPreLoader,textureButtonReplay,buttonReplay,textureButtonStart,buttonStart,textureButtonFullscreen,buttonFullscreen,texturePreLoader,preLoader,musicBackground,musicGameOver,flagCollision,gapBetweenBirds=0,enemy=[],filtersValue=0,fullscreenIndex=1.3,blurFilter=new filters.BlurFilter;const Position={START_X:renderer.width+42.5,START_Y:0,END_X:0,END_Y:450,STEP_X:10,STEP_Y:8,SCORE_X:50,SCORE_Y:480};let style={fontFamily:"Arial",fontSize:"30px",fontStyle:"italic",fontWeight:"bold",fill:"#ffffff",stroke:"#4a1850",strokeThickness:5,dropShadow:!0,dropShadowColor:"#000000",dropShadowAngle:Math.PI/6,dropShadowDistance:6},imageLinks={background1:"assets/images/background/1.png",background2:"assets/images/background/2.png",background3:"assets/images/background/3.png",background4:"assets/images/background/4.png",background5:"assets/images/background/5.png",fatBird1:"assets/images/fat_bird/1.png",fatBird2:"assets/images/fat_bird/2.png",fatBird3:"assets/images/fat_bird/3.png",fatBird4:"assets/images/fat_bird/4.png",fatBird5:"assets/images/fat_bird/5.png",fatBird6:"assets/images/fat_bird/6.png",fatBird7:"assets/images/fat_bird/7.png",fatBird8:"assets/images/fat_bird/8.png",monsterFly1:"assets/images/monster/fly/1.png",monsterFly2:"assets/images/monster/fly/2.png",monsterFly3:"assets/images/monster/fly/3.png",monsterFly4:"assets/images/monster/fly/4.png",stupidBirdFly1:"assets/images/stupid_bird/fly/1.png",stupidBirdFly2:"assets/images/stupid_bird/fly/2.png",stupidBirdFly3:"assets/images/stupid_bird/fly/3.png",stupidBirdFly4:"assets/images/stupid_bird/fly/4.png",stupidBirdFly5:"assets/images/stupid_bird/fly/5.png",stupidBirdFly6:"assets/images/stupid_bird/fly/6.png",stupidBirdFly7:"assets/images/stupid_bird/fly/7.png",stupidBirdFly8:"assets/images/stupid_bird/fly/8.png",chickenFly1:"assets/images/chicken/fly/1.png",chickenFly2:"assets/images/chicken/fly/2.png",chickenFly3:"assets/images/chicken/fly/3.png",chickenFly4:"assets/images/chicken/fly/4.png",plane:"assets/images/plane/fighter.png",planeJSON:"assets/images/plane/fighter.json",replay_button:"assets/images/replay_button/replay_button_1.png",replay_button_down:"assets/images/replay_button/replay_button_2.png",replay_button_over:"assets/images/replay_button/replay_button_3.png",start_button:"assets/images/start_button/start_button_1.png",start_button_down:"assets/images/start_button/start_button_2.png",start_button_over:"assets/images/start_button/start_button_3.png",fullscreen_button:"assets/images/fullscreen_button/fullscreen_button_1.png",fullscreen_button_over:"assets/images/fullscreen_button/fullscreen_button_2.png",fullscreen_button_down:"assets/images/fullscreen_button/fullscreen_button_3.png"},monsterImages=[imageLinks.monsterFly1,imageLinks.monsterFly2,imageLinks.monsterFly3,imageLinks.monsterFly4],fatBirdImages=[imageLinks.fatBird1,imageLinks.fatBird2,imageLinks.fatBird3,imageLinks.fatBird4,imageLinks.fatBird5,imageLinks.fatBird6,imageLinks.fatBird7,imageLinks.fatBird8],stupidBirdImages=[imageLinks.stupidBirdFly1,imageLinks.stupidBirdFly2,imageLinks.stupidBirdFly3,imageLinks.stupidBirdFly4,imageLinks.stupidBirdFly5,imageLinks.stupidBirdFly6,imageLinks.stupidBirdFly7,imageLinks.stupidBirdFly8],chickenImages=[imageLinks.chickenFly1,imageLinks.chickenFly2,imageLinks.chickenFly3,imageLinks.chickenFly4],monsterSprites=[monsterImages,fatBirdImages,stupidBirdImages,chickenImages];function gameLoop(){let e=Date.now();gameTime=e-startTime,requestAnimationFrame(gameLoop),state(),renderer.render(stage)}function getRandomIntValue(e,t){return Math.round(Math.random()*(t-e)+e)}function resizeCanvas(){let e,t;window.innerWidth/window.innerHeight>=ratio?(e=window.innerHeight*ratio,t=window.innerHeight):(e=window.innerWidth,t=window.innerWidth/ratio),renderer.view.style.position="",renderer.view.style.width=e/fullscreenIndex+"px",renderer.view.style.height=t/fullscreenIndex+"px"}resizeCanvas(),preLoaderFunc(),startTime=Date.now(),document.body.addEventListener("keydown",function(e){switch(e.keyCode){case 37:plane.velocityHorizontal=-20;break;case 38:plane.velocityVertical=20;break;case 39:plane.velocityHorizontal=20;break;case 40:plane.velocityVertical=-20}e.preventDefault()}),document.body.addEventListener("keyup",function(e){38==e.keyCode||40==e.keyCode?plane.velocityVertical=0:37!=e.keyCode&&39!=e.keyCode||(plane.velocityHorizontal=0)}),window.addEventListener("resize",resizeCanvas);
function Monster(i,e){this.hideEnemy=!1;for(var t=[],o=0;o<i.length;o++){var h=Texture.fromImage(i[o]);t.push(h)}this.movieclip=new AnimatedSprite(t),this.movieclip.scale.x=-1,this.movieclip.anchor.set(.5),this.movieclip.x=e,this.movieclip.y=getRandomIntValue(Position.START_Y+this.movieclip.height/2,Position.END_Y-this.movieclip.height/2),this.movieclip.animationSpeed=.4,this.movieclip.play(),gameScene.addChild(this.movieclip)}Monster.prototype.updatePosition=function(){this.movieclip.x>Position.END_X-this.movieclip.width/2?this.movieclip.x-=Position.STEP_X:(this.hideEnemy=!0,this.movieclip.destroy(),this.movieclip=null)};
class PlaneAnimation extends PIXI.extras.AnimatedSprite{constructor(...t){super(...t),this.velocityVertical=0,this.velocityHorizontal=0,this.planeIndent=5,this.x=100,this.y=200,this.anchor.set(.5),this.animationSpeed=.5,this.rotation=Math.PI/2,this.width=85,this.height=120,this.interactive=!0,this.buttonMode=!0,this.on("mousedown",this.onDragStart).on("touchstart",this.onDragStart).on("pointerup",this.onDragEnd).on("pointerupoutside",this.onDragEnd).on("mousemove",this.onDragMove).on("touchmove",this.onDragMove)}onDragStart(t){this.data=event.data,this.dragging=!0,"touchstart"===t.type?this.x+=this.width:this.x}onDragEnd(){this.alpha=1,this.dragging=!1,this.data=null}onDragMove(t){if(this.dragging){let i=t.data.getLocalPosition(stage);this.x="touchmove"===t.type?i.x+this.width:i.x,this.y=i.y}}keyboardVerticalMove(){this&&(this.y-=this.velocityVertical,this.y<=this.planeIndent+this.width/2?this.y=this.planeIndent+this.width/2:this.y>=Position.END_Y-this.width/2&&(this.y=Position.END_Y-this.width/2))}keyboardHorizontalMove(){this&&(this.x+=this.velocityHorizontal,this.x<=this.planeIndent+this.height/2?this.x=this.planeIndent+this.height/2:this.x>=renderer.width-this.height/2-this.planeIndent&&(this.x=renderer.width-this.height/2-this.planeIndent))}}
function play(){if(detectCollision(plane,enemy))state=end,musicBackground.stop(),musicGameOver.play(),plane.onDragEnd();else{backgroundLogic(layer.layer1,200,gameTime),backgroundLogic(layer.layer2,160,gameTime),backgroundLogic(layer.layer3,120,gameTime),backgroundLogic(layer.layer4,80,gameTime),backgroundLogic(layer.layer5,60,gameTime),plane.keyboardVerticalMove(),plane.keyboardHorizontalMove();for(let e=0;e<enemy.length;e++)enemy[e].updatePosition(),enemy[e].hideEnemy&&enemy.splice(e,1,new Monster(monsterSprites[getRandomIntValue(0,monsterSprites.length-1)],Position.START_X));scoreChange(gameTime)}}
function preLoaderFunc(){preLoaderScene=new Container,gameElements.addChild(preLoaderScene),darkEffectPreLoader=new Graphics,darkEffectPreLoader.beginFill(0,1),darkEffectPreLoader.drawRect(0,0,1920,1080),preLoaderScene.addChild(darkEffectPreLoader),musicBackground=new Howl({src:["assets/music/background_music.mp3"],volume:.5}),style.fontSize="50px",rotateScreen=new Text("Переверните экран!",style),rotateScreen.x=renderer.view.width/2-rotateScreen.width/2,rotateScreen.y=renderer.view.height/1.5-rotateScreen.height/2,rotateScreen.visible=!1,uiElements.addChild(rotateScreen);loader.add("assets/images/preLoader.png"),texturePreLoader=Texture.fromImage("assets/images/preLoader.png"),preLoader=new Sprite(texturePreLoader),preLoader.anchor.set(.5),preLoader.x=renderer.width/2-preLoader.width/2,preLoader.y=renderer.height/2-preLoader.height/2,preLoaderScene.addChild(preLoader);for(let e in imageLinks)loader=loader.add(imageLinks[e]);loader.on("progress",function(e){console.log("progress: "+Math.round(e.progress)+"%")}).load(function(){console.log("All files loaded"),preLoaderScene.removeChild(preLoader),createStartButton(),createFullscreenButton()}),state=rotatePreLoader,gameLoop()}function rotatePreLoader(){preLoader.rotation+=.1}function createStartButton(){textureButtonStart={original:Texture.fromImage(imageLinks.start_button),down:Texture.fromImage(imageLinks.start_button_down),over:Texture.fromImage(imageLinks.start_button_over),positionX:renderer.width/2,positionY:renderer.height/2,scale:.5},buttonStart=new Button(textureButtonStart,"start"),preLoaderScene.addChild(buttonStart)}function createFullscreenButton(){textureButtonFullscreen={original:Texture.fromImage(imageLinks.fullscreen_button),over:Texture.fromImage(imageLinks.fullscreen_button_over),down:Texture.fromImage(imageLinks.fullscreen_button_down),positionX:renderer.width-50,positionY:renderer.height-40,scale:.3},buttonFullscreen=new Button(textureButtonFullscreen,"fullscreen"),uiElements.addChild(buttonFullscreen)}
function reset(){gameOverScene.visible=!1,plane.x=100,plane.y=200,plane.rotation=Math.PI/2,gapBetweenBirds=0;for(var e=0;e<enemy.length;e++)enemy[e].movieclip.x=Position.START_X+gapBetweenBirds,gapBetweenBirds+=(renderer.width-3*enemy[e].movieclip.width)/4+enemy[e].movieclip.width,enemy[e].movieclip.y=getRandomIntValue(Position.START_Y+enemy[e].movieclip.height/2,Position.END_Y-enemy[e].movieclip.height/2),enemy[e].movieclip.rotation=0;gameScene.addChild(score),gameOverScene.removeChild(score),score.x=Position.SCORE_X,score.y=Position.SCORE_Y,score.scale.x=1,score.scale.y=1,startTime=Date.now(),state=play,musicBackground.play(),gameScene.filters=[],filtersValue=0}
function scoreAdd(){style.fontSize="30px",score=new Text("Score: "+distance,style),score.x=Position.SCORE_X,score.y=Position.SCORE_Y,gameScene.addChild(score)}function scoreChange(e){distance=Math.round(e/1e3*10),score.text="Score: "+distance}
function setup(){gameScene=new Container,gameElements.addChild(gameScene),backgroundAddOnScene();for(var e=0;e<4;e++)enemy[e]=new Monster(monsterSprites[e],Position.START_X+gapBetweenBirds),gapBetweenBirds+=(renderer.width-3*enemy[e].movieclip.width)/4+enemy[e].movieclip.width;for(var n=[],a=0;a<30;a++){var r=a<10?"0"+a:a;n.push(Texture.fromFrame("rollSequence00"+r+".png"))}plane=new PlaneAnimation(n),plane.play(),gameScene.addChild(plane),scoreAdd(),musicGameOver=new Howl({src:["assets/music/game_over_music.mp3"],volume:.5}),gameOverScene=new Container,gameElements.addChild(gameOverScene),gameOverScene.visible=!1,darkEffectEndGame=new Graphics,darkEffectEndGame.beginFill(0,.6),darkEffectEndGame.drawRect(0,0,renderer.width,renderer.height),gameOverScene.addChild(darkEffectEndGame),style.fontSize="50px",message=new Text("Game over!",style),message.x=renderer.width/2-message.width/2,message.y=renderer.height/3-message.height/2,gameOverScene.addChild(message),textureButtonReplay={original:Texture.fromImage(imageLinks.replay_button),down:Texture.fromImage(imageLinks.replay_button_down),over:Texture.fromImage(imageLinks.replay_button_over),positionX:renderer.width/2,positionY:renderer.height/2,scale:.5},buttonReplay=new Button(textureButtonReplay,"replay"),gameOverScene.addChild(buttonReplay),startTime=Date.now(),state=play}